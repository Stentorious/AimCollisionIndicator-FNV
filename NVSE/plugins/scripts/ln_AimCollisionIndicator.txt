; Aim Collision Indicator - Stentorious

; Update indicator on load
SetUIFloatAlt "HUDMainMenu\AimCollision\_Dist" 10000
Call (CompileScript "AimCollisionIndicator\OnEquip.gek") Player (Player.GetEqObj 5)

; On Game Restart
if Goo1.AuxVarGetFlt "*AimCol_Init" == 1
	return
endif
Goo1.AuxVarSetFlt "*AimCol_Init" 1

; Check for requirements
if eval GetNVSEVersion < 6 || (GetNVSEVersion == 6 && GetNVSERevision < 4)
	MessageBoxEx "Aim Collision Indicator missing requirement!%rInstall xNVSE 6.4.0+."
	return
endif
if GetPluginVersion "JohnnyGuitarNVSE" < 390
	MessageBoxEx "Aim Collision Indicator missing requirement!%rInstall latest JohnnyGuitar NVSE plugin."
	return
endif
if GetPluginVersion "ShowOffNVSE Plugin" < 145
	MessageBoxEx "Aim Collision Indicator missing requirement!%rInstall latest ShowOff NVSE plugin."
	return
endif
if GetPluginVersion "UI Organizer Plugin" < 230
	MessageBoxEx "Aim Collision Indicator missing requirement!%rInstall latest User Interface Organizer plugin."
	return
endif

; Load INI settings
SetUIFloatAlt "HUDMainMenu\AimCollision\_Icon" (GetINIFloat_Cached "Indicator:iType" "Stentorious\AimCollisionIndicator.ini" 0)
SetUIFloatAlt "HUDMainMenu\AimCollision\_Scale" (Clamp (GetINIFloat_Cached "Indicator:fScale" "Stentorious\AimCollisionIndicator.ini" 1.0) 0.5 2)
SetUIFloatAlt "HUDMainMenu\AimCollision\_Alpha" (Clamp (GetINIFloat_Cached "Indicator:fAlpha" "Stentorious\AimCollisionIndicator.ini" 1.0) 0.1 1)
SetUIFloatAlt "HUDMainMenu\AimCollision\systemcolor" (GetINIFloat_Cached "Color:iSystemcolor" "Stentorious\AimCollisionIndicator.ini" 2)
SetUIFloatAlt "HUDMainMenu\AimCollision\red" (GetINIFloat_Cached "Color:iRed" "Stentorious\AimCollisionIndicator.ini" 0)
SetUIFloatAlt "HUDMainMenu\AimCollision\green" (GetINIFloat_Cached "Color:iGreen" "Stentorious\AimCollisionIndicator.ini" 0)
SetUIFloatAlt "HUDMainMenu\AimCollision\blue" (GetINIFloat_Cached "Color:iBlue" "Stentorious\AimCollisionIndicator.ini" 0)
SetUIFloatAlt "HUDMainMenu\AimCollision\_VisHip1st" (eval GetINIFloat_Cached "Visibility:bHipFire1st" "Stentorious\AimCollisionIndicator.ini" 1)
SetUIFloatAlt "HUDMainMenu\AimCollision\_VisHip3rd" (eval GetINIFloat_Cached "Visibility:bHipFire3rd" "Stentorious\AimCollisionIndicator.ini" 0)
SetUIFloatAlt "HUDMainMenu\AimCollision\_VisAim1st" (eval GetINIFloat_Cached "Visibility:bAiming1st" "Stentorious\AimCollisionIndicator.ini" 1)
SetUIFloatAlt "HUDMainMenu\AimCollision\_VisAim3rd" (eval GetINIFloat_Cached "Visibility:bAiming3rd" "Stentorious\AimCollisionIndicator.ini" 1)
SetUIFloatAlt "HUDMainMenu\AimCollision\_VisScope" (eval GetINIFloat_Cached "Visibility:bScoped" "Stentorious\AimCollisionIndicator.ini" 1)
SetUIFloatAlt "HUDMainMenu\AimCollision\_VisActor" (eval GetINIFloat_Cached "Visibility:bActor" "Stentorious\AimCollisionIndicator.ini" 0)
SetUIFloatAlt "HUDMainMenu\AimCollision\_VisCombat" (eval GetINIFloat_Cached "Visibility:bCombat" "Stentorious\AimCollisionIndicator.ini" 0)
SetUIFloatAlt "HUDMainMenu\AimCollision\_DistMax" (Clamp (GetINIFloat_Cached "Visibility:fDistance" "Stentorious\AimCollisionIndicator.ini" 1.5) 1 25)
SetUIFloatAlt "HUDMainMenu\AimCollision\_JDC" (eval GetINIFloat_Cached "Indicator:bJDCSupport" "Stentorious\AimCollisionIndicator.ini" 0)
Goo1.AuxVarSetFlt "*_AimCol_INI" (eval GetINIFloat_Cached "Visibility:bWeaponAnimations" "Stentorious\AimCollisionIndicator.ini" 0) 0

; Update indictor on (un)equip
SetEventHandler "OnEquip" (CompileScript "AimCollisionIndicator\OnEquip.gek") "first"::Player
SetEventHandler "OnUnequip" (CompileScript "AimCollisionIndicator\OnUnequip.gek") "first"::Player

; Clear INI cache
CloseFileSO "Stentorious\AimCollisionIndicator.ini" 0
